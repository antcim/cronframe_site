"use strict";(self.webpackChunkcronframesite=self.webpackChunkcronframesite||[]).push([[36],{9134:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var o=t(4848),r=t(8453);const i={sidebar_position:4},a="Method Job",s={id:"tutorial-framework/Job Definition/method job",title:"Method Job",description:'A method annotated with the mt_job macro defined inside the implementation block of a cron object is known as a "method job" inside cronframe.',source:"@site/docs/tutorial-framework/Job Definition/method job.md",sourceDirName:"tutorial-framework/Job Definition",slug:"/tutorial-framework/Job Definition/method job",permalink:"/cronframe_site/it/docs/next/tutorial-framework/Job Definition/method job",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/tutorial-framework/Job Definition/method job.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Function Job",permalink:"/cronframe_site/it/docs/next/tutorial-framework/Job Definition/function job"},next:{title:"Without Macros",permalink:"/cronframe_site/it/docs/next/tutorial-framework/Job Definition/no_macros"}},c={},d=[];function h(e){const n={code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"method-job",children:"Method Job"})}),"\n",(0,o.jsxs)(n.p,{children:["A method annotated with the ",(0,o.jsx)(n.code,{children:"mt_job"}),' macro defined inside the implementation block of a cron object is known as a "method job" inside cronframe.']}),"\n",(0,o.jsx)(n.p,{children:"The macro only takes one attibute:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["expr","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"the name of the field of type CronFrameExpr to use for the scheduling"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"As we can see, the timeout attribute is no longer present and the expr attribute is rather different."}),"\n",(0,o.jsx)(n.p,{children:"The type CronFrameExpr contains both the cron expression and the timeout to use for the scheduling of a method job. We can have as many fields of this type as we require for scheduling jobs."}),"\n",(0,o.jsx)(n.p,{children:"We extend the code of the cron object defined on the previous page and add a method job to it."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'#[marco_use] extern crate cronframe;\n\nuse cronframe::{CronFrame, CronFrameExpr};\n\n#[cron_obj]\nstruct WeatherJob{\n    city: String,\n    schedule: CronFrameExpr,\n}\n\n#[cron_impl]\nimpl WeatherJob{\n    #[fn_job(expr="0 0 0/12 * * *", timeout="0")]\n    fn my_function_job(){\n        println!("I run once every 12 hours every day.");\n    }\n\n    #[fn_job(expr="schedule")]\n    fn my_method_job(self){\n        println!("I run according to the schedule field.");\n    }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Now that we have the job definition down, we need to create an instance of the cron object and passit to the framework instance so that it can run."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-rust",children:'use cronframe::CronFrame;\n\nfn main(){\n    let cronframe = CronFrame::default();\n\n    let weather_job = WeatherJob::new_cron_obj("Venice".to_string(), "0 0 0/12 * * *".into());\n\n    cronframe.cf_gather_mt(cronframe.clone()); \n\n    cronframe.run(); \n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The function ",(0,o.jsx)(n.code,{children:"new_cron_obj"})," is injected by the framework inside cron objects and allows for creating an new instance by passing as arguments variables of the same type as the fields in the order they are defined in the struct."]}),"\n",(0,o.jsxs)(n.p,{children:["The function ",(0,o.jsx)(n.code,{children:"cf_gather_mt"})," is injected by the framework inside cron objects, it collects all method jobs and passes them to cronframe."]}),"\n",(0,o.jsx)(n.p,{children:"Method jobs are related to an instance of the cron object rather than one of its type."}),"\n",(0,o.jsxs)(n.p,{children:["Alternatively if we wanted to collect both functions and methods jobs at the same time we could use the ",(0,o.jsx)(n.code,{children:"cf_gather"})," method injected by the framework inside cron objects which is a short hand for calling both ",(0,o.jsx)(n.code,{children:"cf_gather_fn"})," and ",(0,o.jsx)(n.code,{children:"cf_gather_mt"})," with one function call."]})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>s});var o=t(6540);const r={},i=o.createContext(r);function a(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);